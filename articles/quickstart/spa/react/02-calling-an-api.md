---
title: Calling an API
description: This tutorial demonstrates how to make API calls for protected resources on your server.
budicon: 546
topics:
  - quickstarts
  - spa
  - react
  - apis
github:
  path: 02-Calling-an-API
sample_download_required_data:
  - client
  - api
contentType: tutorial
useCase: quickstart
---

<!-- markdownlint-disable MD041 MD002 -->

Most single page applications use resources from data APIs. You may want to restrict access to those resources, so that only authenticated users with sufficient privileges can access them. Auth0 lets you manage access to these resources using [API Authorization](/api-auth).

This tutorial shows you how to create a simple API using [Express](https://expressjs.com) that validates incoming JSON Web Tokens. You will then see how to call this API using an Access Token granted by the Auth0 authorization server.

<%= include('../_includes/_calling_api_create_api') %>

<%= include('../_includes/_calling_api_create_backend.md') %>

Finally, modify `package.json` to add two new scripts `dev` and `server` that can be used to start the frontend and the backend API together:

```json
scripts": {
  "start": "react-scripts start",
  "build": "react-scripts build",
  "test": "react-scripts test",
  "eject": "react-scripts eject",
  "dev": "npm-run-all --parallel start server",
  "server": "node server.js"
},
```

## Proxy to the Backend API

In this example, the backend and the frontend apps run on two different ports. In order to call the API from the frontend application, the development server must be configured to proxy requests through to the backend API. This is so that the frontend application can make a request to `/api/external` and it will be correctly proxied through to the backend API at `http://localhost:3001/api/external`.

To do this, open the `package.json` file in the root of the project and add a new key `proxy` with a value of `http://localhost:3001`.

Your `package.json` file should look something like the following with these changes in place (some values have been omitted for brevity):

```json
{
  "name": "auth0-react-03-calling-an-api",
  "version": "0.1.0",
  "private": true,
  "scripts": {...},
  "dependencies": { ... },
  "devDependencies": { ... },
  "eslintConfig": { ... },
  "browserslist": { ... },
  "proxy": "http://localhost:3001"
}
```

## Specify the API Audience

For calls to the API to work properly and for access tokens to be correctly validated, the frontend application must specify the correct API audience when authenticating with Auth0. In this scenario, the application should be configured with the API identifier value (the audience) that was created ealier when the API was created in the Auth0 dashboard.

To specify the audience, open `src/auth_config.json` and add a new key called `audience` with the API identifier created earlier as the value:

```json
{
  "domain": "${account.namespace}",
  "clientId": "${account.clientId}",
  "audience": "${apiIdentifier}"
}
```

Next, open `src/index.js` where the `Auth0Provider` component is initialized and specify the audience value from the configuration in the `audience` prop:

```jsx
ReactDOM.render(
  <Auth0Provider
    domain={config.domain}
    client_id={config.clientId}
    redirect_uri={window.location.origin}
    audience={config.audience},     // NEW - specify the audience value
    onRedirectCallback={onRedirectCallback}
  >
    <App />
  </Auth0Provider>,
  document.getElementById("root")
);
```

With these changes, access tokens generated by Auth0 will now have the correct audience value and can be validated properly by the backend API.

## Call the API

To provide a mechanism for calling the API, create a new component called `ExternalApi.js` and populate it with the following content:

```jsx
// src/components/ExternalApi.js

import React, { useState } from "react";
import { useAuth0 } from "../react-auth0-wrapper";

const ExternalApi = () => {
  const [showResult, setShowResult] = useState(false);
  const [apiMessage, setApiMessage] = useState("");
  const { getTokenSilently } = useAuth0();

  const callApi = async () => {
    try {
      const token = await getTokenSilently();

      const response = await fetch("/api/external", {
        headers: {
          Authorization: `Bearer <%= "${token}" %>`
        }
      });

      const responseData = await response.json();

      setShowResult(true);
      setApiMessage(responseData);
    } catch (error) {
      console.error(error);
    }
  };

  return (
    <>
      <h1>External API</h1>
      <button onClick={callApi}>Ping API</button>
      {showResult && <code>{JSON.stringify(apiMessage, null, 2)}</code>}
    </>
  );
};

export default ExternalApi;
```

This component shows a button on the UI that allows the user to call the backend API. When clicked, the token is fetched from the Aut0 SDK client using `getTokenSilently()`. Notice that this function returns a `Promise` and is asyncronous. This function attempts to return the current access token. If the token is invalid, the token is refreshed silently before being returned from the function.

Once the token has been retrieved, it is used in a call using `fetch` as the bearer token in the Authorization header. The backend API will then validate this token and return either a `401 Unauthorized` response, or a `200` response with a JSON message. In this case, if a successful JSON message is received then it is displayed on the screen for the user.

To allow the user to get to this new page, modify the routing in the `App.js` file by adding a new `PrivateRoute` component to the route markup. This means that the user will not be able to get to this page without logging in.

The new route should have a `path` value of `/external-api`. The `App.js` file should look like the following after these changes are made:

```jsx
// other imports removed for brevity

// NEW - import the ExternalApi component
import ExternalApi from "./components/ExternalApi";

function App() {
  return (
    {/* other components removed for brevity */}
    <Switch>
      <Route path="/" exact />
      <PrivateRoute path="/profile" component={Profile} />

      {/* NEW - add a route to the ExternalApi component */}
      <PrivateRoute path="/external-api" component={ExternalApi} />
    </Switch>
  );
}

export default App;
```

Finally, update the navigation so that the user can click on a link to get to this new page:

```jsx
// src/components/NavBar.js

// code omitted for brevity

{
  isAuthenticated && (
    <span>
      <Link to="/">Home</Link>&nbsp;
      <Link to="/profile">Profile</Link>&nbsp;
      {/* NEW - Add a link to the /external-api route */}
      <Link to="/external-api">External API</Link>
    </span>
  );
}
```

Now run the application again. The user should be able to click on the **External API** link to visit the new page, and click on the **Ping API** button to invoke a call to the backend API. If the call is successful, the response JSON should be visible on the page.

Now log out, and try to access the `/external-api` page through the URL without being logged in. You should be prompted to log in.
