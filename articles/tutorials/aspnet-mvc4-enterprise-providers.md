---
title: Using Auth0 with ASP.NET MVC 4 - Enterprise Providers
---

# Using Auth0 with ASP.NET MVC 4 - Enterprise Providers

Auth0 creates many new posibilities for developers by providing them with the ability to easily, and effortlessly integrate their application with their customer's user directories. In this tutorial, we will demonstrate the simplicity and ease of enabling enterprise single-sign ons in your Asp.Net MVC 4 application by guiding you through the setup process. 

## Before you start

1. This is a continuation of the [previous tutorial](/server-platforms/aspnet). Please make sure you have all the files and information from the tutorial fully completed and readily available.  
2. Ensure the settings you previously used for Auth0 Web.config are still entered in <appSettings>. 

## Integrating Auth0 with MVC4

### 1. Enable an enterprise provider

Go to [Enterprise Connections](${uiURL}/#/connections/enterprise) in your dashboard and enable Google-Apps connections by providing the settings you used for Google OAuth2 in the previous tutorial.

### 2. Create a new provisioning route

Our first step is to create a route that will allow us to associate new companies to your application. Simply create a new controller named ProvisioningController using the following code:

```cs
public class ProvisioningController : Controller
{
    private readonly Auth0.Client auth0Client = new Auth0.Client(
                "${account.clientId}",
                "${account.clientSecret}",
                "${account.namespace}");

    [HttpPost]
    public ActionResult Index(Auth0.ProvisioningTicket ticket)
    {
        return Json(auth0Client.CreateConnection(ticket));
    }
}
```

> Please be aware that we are creating a very simple route for this tutorial. In most production scenarios, you will likely have a full process for company sign ups and additional data requests than what is required by Auth0. For these more complex scenarios, please refer to the different overloads of `Client.CreateConnection` method.
>

### 3. Add the provisioning widget

In the previous article we added the login widget to simplify the social and enterprise sign on. Auth0 additionally provides a very simple provisioning widget for enterprise providers. Modify your `_LoginPartial.cshtml file to add the **sign up my company** link:


```html
@if (Request.IsAuthenticated) {
    <text>
        Hello, @Html.ActionLink(User.Identity.Name, "Manage", "Account", routeValues: null, htmlAttributes: new { @class = "username", title = "Manage" })!
        @using (Html.BeginForm("LogOff", "Account", FormMethod.Post, new { id = "logoutForm" })) {
            @Html.AntiForgeryToken()
            <a href="javascript:document.getElementById('logoutForm').submit()">Log off</a>
        }
    </text>
} else {
    <ul>
        <li><a href="javascript:window.Auth0.signIn({onestep: true})">login</a></li>
        <li><a href="javascript:window.Auth0.showProvisioning('/Provisioning')">sign up my company</a></li>
    </ul>
    <script src="${sdkURL}/auth0.js#client=${account.clientId}&authorize_url=/Account/Auth0Login"></script>
}
```

### 4. Handle success delegation

Once the domain administrator follows the provisioning link generated by the previous step, they will be redirected to the same callback we used for login. In steps 4.a and 4.b we will add the new connection to our list of Auth0 providers and also display a page notifying the end user that the process has succesfuly completed. 

#### 4.a Modify the `ExternalLoginCallback` method in `AccountController.cs` as follows:

```cs
[AllowAnonymous]
public ActionResult ExternalLoginCallback(string returnUrl, bool granted, string domain, string connection)
{
    if (granted && !string.IsNullOrEmpty(domain))
    {
        OAuthWebSecurity.RegisterClient(new Auth0.OpenAuthClient(connection,
                                                            "${account.clientId}",
                                                            "${account.clientSecret}",
                                                            "${account.namespace}",
                                                            connection), connection, new Dictionary<string, object>());

        ViewBag.domain = domain;
        ViewBag.connection = connection;
        return View("Domain_Granted");
    }

    //.... same code you have before next
```

#### 4.b Create a view named `Domain_Granted` in `Views\Account`:

```html
@model dynamic
@{
    ViewBag.Title = "Company setup";
    Layout = "../Shared/_Layout.cshtml";
}

<h2>Company setup</h2>
<p>
    Your company @ViewBag.domain has been setup
</p>
```


### 5. Create a custom route for enterprise login

This step is optional, but enhances the login process for enterprise users. The default login process for enterprise users is to enter in their work email address into the login widget. In this step, we will create the ability to add a friendly url to this tutorial application to allow enterprise users to directly login to the application. `http://ourproduct.com/e/bigcompany.com`.


Create a new controller named EnterpriseLoginController:

```cs
public class EnterpriseLoginController : Controller
{
    //
    // GET: /EnterpriseLogin/
    public ActionResult Open(string domain)
    {
        return new AccountController.ExternalLoginResult(
                domain,
                Url.Action("ExternalLoginCallback", "Account"));
    }
}
```


Modify the `RouteConfig.cs` file and add a new route **before** the default route:

```cs
routes.MapRoute(
    "Enterprise Login",
    "e/{domain}",
    new { controller = "EnterpriseLogin", action = "Open" });
```

And modify the `Domain_Granted`, add the following link:

```html
<a href="/e/@ViewBag.connection"> login as @ViewBag.domain </a>
```

When Enterprise Users visit this URL they are automatically redirected to their company login page:

![](/media/articles/tutorials/mvc-tutorial-enterprise/enterprise-login.png)

## Testing the app:

Open a browser, navigate to the website and press the **sign up my company** link. You should see the provisioning widget and if you have an enterprise account you will now be able to register a company:

![](/media/articles/tutorials/mvc-tutorial-enterprise/widget-prov-in-aspnet.png)

Congratulations!
