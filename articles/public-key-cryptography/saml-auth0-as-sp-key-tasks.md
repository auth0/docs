---
url: /saml/auth0-as-sp
---

## Auth0 as Service Provider (SAML connection)

When you use Auth0 as Service Provider there are some tasks that you may need to perform, with regards to keys:
+ Download public key/certificate for Identity Provider (IDP) to validate the signature.
+ Upload public key/certificate from IDP.
+ Download public key/certificate for IDP to encrypt assertions, if needed.
+ Upload a custom keypair, private key, or certificate via the Management API.
+ Updating certificates.

::: panel-info More information on Auth0 as a Service Provider
This article describes only those tasks are related to keys and certificates. For detailed information on how to configure Auth0 as a Service Provider, please refer to the document [Auth0 as Service Provider](/saml-sp-generic) or watch [this](/saml-configuration#configuring-auth0-as-a-service-provider) video.
:::

### Download public key/certificate for IDP to validate the signature

In order for the IDP to validate the signature of each SAML authentication request sent by Auth0, the public key and the certificate have to be provided.

1. Open the Auth0 dashboard and navigate to [Connections > Enterprise](${uiURL}/#/connections/enterprise). Click on the __SAMLP Identity Provider__.
2. Click on the __Settings__ (gear) icon for your SAMLP connection.
3. Turn on the toggle for __Sign Request__.
4. Select the __Sign Request Algorithm__ and the __Sign Request Digest Algorithm__ acceptable to your IDP.

	> SHA256 should be used, since SHA1 is now considered obsolete and insecure.

5. Set the __Protocol Binding__ to _HTTP-POST_, if your IDP can accept it as signed requests may be too long for use with the _HTTP-Redirect_ protocol binding.
6. Download your certificate, using the link in the text below the __Sign Request__ toggle.
7. Give the downloaded certificate to the IDP, for use in validating the signed authentication request.

![](media/articles/public-key-cryptography/sp-download-cert.png)

### Upload public key/certificate from IDP

In order for Auth0 to validate the signed authentication responses coming from the IDP, you have to upload to Auth0 the certificate that your IDP will provide you with. This is done as part of the initial connection setup, but a new certificate can be uploaded at any time.

1. Obtain the certificate from the IDP and if necessary, convert to .pem format.
2. Open the Auth0 dashboard and navigate to [Connections > Enterprise](${uiURL}/#/connections/enterprise). Click on the __SAMLP Identity Provider__.
3. Click on the __Settings__ (gear) icon for your SAMLP connection.
4. Use the __UPLOAD CERTIFICATE__ button to upload the certificate file from IDP.

![](media/articles/public-key-cryptography/sp-upload-cert.png)

### Download public key/certificate for IDP to encrypt assertions

Optionally, assertions can be encrypted. In order for the IDP to make the relevant configuration your public key will have to be provided. 

1. Open the Auth0 dashboard and navigate to [Connections > Enterprise](${uiURL}/#/connections/enterprise). Click on the __SAMLP Identity Provider__.
2. Click on the __Settings__ (gear) icon for your SAMLP connection.
3. Under __Encrypted Assertions__, use the links for CER, PEM or PKCS#7 to download a public key/certificate in the format needed for your IDP.

![](media/articles/public-key-cryptography/sp-encrypted-assertions.png)

### Upload a custom keypair, private key, or certificate via the Management API

If you need to load your own private key into Auth0 instead of using the default one generated by Auth0, or you wish to create connections and upload certificates programmatically, you can use the Auth0 Management API. 

There are different attributes used for the following functions, so be sure to use the right attribute:

| Management APIv2 Attribute | Use  |
| -------------------------- | ---- |
| signing_key                | Signing a SAML authNRequest |
| signingCert                | Validating signature on a SAML authN Response |
| decryptionKey              | Decrypting a response/assertion sent encrypted by IDP |

To update via the Management APIv2 explorer:

1. Log into Auth0 dashboard
2. Using the same browser, navigate to [Management APIv2](https://auth0.com/docs/api/v2)
3. Under __SCOPES__, select the _read: connections_, by selecting _connections_ at the __entity__ dropdown, and _read_ at the __actions__ dropdown. Click the arrow pointing to the right to add the scope.

	![](media/articles/public-key-cryptography/mgmt-api-scope-read-conn.png)

4. Select the _update: connections_, by selecting the _update_ value at the __actions__ dropdown and clicking once more the arrow pointing to the right.

	![](media/articles/public-key-cryptography/mgmt-api-scope-update-conn.png)

5. On the __API REFERENCE__ menu on the left, select [Connections > Get all connections](/api/v2#!/Connections/get_connections)

6. Scroll down to the _Test this endpoint_ section and click the __TRY__ button.

	![](media/articles/public-key-cryptography/mgmt-api-get-conn-try.png)

7. The __RESPONSE BODY__ contains all your configured connections. Locate the connection you wish to update and copy the connection ID. This is in the _id_ field and is of the form "**con_**_<alphanumeric>_"

	![](media/articles/public-key-cryptography/mgmt-api-get-conn-id.png)

8. On the __API REFERENCE__ menu on the left, select [Connections > Get a connection](/api/v2#!/Connections/get_connections_by_id)

9. At the _Parameters_ section, paste the connection ID you copied earlier at the _id_ field. Click the __TRY__ button.

10. At the __RESPONSE BODY__ there are all the attributes you need for the connection to be updated. Copy the _signInEndpoint_, _signOutEndpoint_, _signingCert_ attributes and supply these options along with the signing key and certificate you wish to upload. If you don't supply them you will get an error.

	> If you have previously loaded a *signing_key* attribute or decryptionKey attribute, you will also need to copy those as well or they will be removed.
	>
	> The _decryptionKey_ attribute is the one for the private key used to decrypt assertions that are sent encrypted by IDP. You need to give the corresponding public key to the IDP for encryption.
	>
	> The _signingCert_ attribute is for the IDP public key encoded in PEM or CER format and used to validate the signature on the SAML response from IDP. The private key is used by the IDP to sign the SAML Response.
	>
	> The *signing_key* attribute is for the private key used by Auth0 to sign the SAMLRequest. Note that this is only used if `connection.options.signSAMLRequest` is `TRUE`, default: `FALSE`)

11. Now you are ready to update the connection. On the __API REFERENCE__ menu on the left, select [Connections > Update a connection](/api/v2#!/Connections/patch_connections_by_id).

12. At the __Parameters__ section, paste the ID of the connection you wish to update, at the __id__ field. 

13. Ath the __body__ field you will have to paste the values to be updated. A template is provided below, but you will have to update the following attributes with the values you copied from your connection earlier:
	+ signInEndpoint
	+ signOutEndpoint
	+ signingCert
	+ decryptionKey (optional, remove from template if not loaded previously)
	+ signing_key (optional, remove from template if not loaded previously)

	Template for body:

	```json
	{
		"options": {
			"signInEndpoint": "https://YOUR-IDP-SSO-URL",
			"signOutEndpoint": "https://YOUR-IDP-SLO-URL",
			"signingCert": "AB...S0K",
			"signSAMLRequest":true,
			"decryptionKey" : "-----BEGIN RSA PRIVATE KEY-----\nMII.Mdm\n-----END RSA PRIVATE KEY-----\n" ,
			"signing_key" : {
				"key":"-----BEGIN RSA PRIVATE KEY-----\nMII...dm\n-----END RSA PRIVATE KEY-----\n",
				"cert":"-----BEGIN CERTIFICATE-----\nMI...6O\n-----END CERTIFICATE-----\n"
			}
		}
	}
	```

	> The example shows "..." for most of the fields for readability. You will have a long line to paste in for each of them.

	Note that the key and cert attributes need to be one long concatenated string. When generated by openssl or other programs, the key/cert are typically in a file with multiple lines so you will have to concatenate the lines, putting a `"\n"` between the lines, and then paste that one long line into the __body__, as shown above.

14. Click the __TRY__ button.